### 1절. 회귀분석 개념

#### 1. 회귀분석

: 원인(독립변수)이 결과(종속변수)에 미치는 영향 추정

#### 2. 선형회귀분석의 가정

-   독립변수와 종속변수 간의 선형성

-   오차의 등분산성

-   오차의 독립성

-   오차의 정규성

#### 3. 그래프를 활용한 선형회귀분석의 가정 검토

1.  선형성

<img src="images/스크린샷%202024-03-28%2023.06.03.png"
width="333" />

1.  등분산성

<img src="images/20151229070833_1058601652.jpg" width="421" />

1.  정규성

<img src="images/QQQQPLOT.jpeg" width="444" />

### 2절. 단순 선형회귀분석

#### 1. 단순 선형회귀분석(단변량 회귀분석)

*Y*<sub>*i*</sub> = *β*<sub>0</sub> + *β*<sub>1</sub>*x*<sub>*i*</sub> + *ϵ*<sub>*i*</sub>

#### 2. 회귀분석 시 검토사항

1.  모형 내의 회귀계수가 유의한가?
2.  모형은 데이터를 얼마나 설명할 수 있는가?
3.  회귀모형은 통계적으로 유의한가?
4.  모형의 데이터를 잘 적합하고 있는가?

#### 3. R을 이용한 단순선형회귀분석

-   lm()

``` r
library(MASS)
data("Cars93")
str(Cars93)
```

    ## 'data.frame':    93 obs. of  27 variables:
    ##  $ Manufacturer      : Factor w/ 32 levels "Acura","Audi",..: 1 1 2 2 3 4 4 4 4 5 ...
    ##  $ Model             : Factor w/ 93 levels "100","190E","240",..: 49 56 9 1 6 24 54 74 73 35 ...
    ##  $ Type              : Factor w/ 6 levels "Compact","Large",..: 4 3 1 3 3 3 2 2 3 2 ...
    ##  $ Min.Price         : num  12.9 29.2 25.9 30.8 23.7 14.2 19.9 22.6 26.3 33 ...
    ##  $ Price             : num  15.9 33.9 29.1 37.7 30 15.7 20.8 23.7 26.3 34.7 ...
    ##  $ Max.Price         : num  18.8 38.7 32.3 44.6 36.2 17.3 21.7 24.9 26.3 36.3 ...
    ##  $ MPG.city          : int  25 18 20 19 22 22 19 16 19 16 ...
    ##  $ MPG.highway       : int  31 25 26 26 30 31 28 25 27 25 ...
    ##  $ AirBags           : Factor w/ 3 levels "Driver & Passenger",..: 3 1 2 1 2 2 2 2 2 2 ...
    ##  $ DriveTrain        : Factor w/ 3 levels "4WD","Front",..: 2 2 2 2 3 2 2 3 2 2 ...
    ##  $ Cylinders         : Factor w/ 6 levels "3","4","5","6",..: 2 4 4 4 2 2 4 4 4 5 ...
    ##  $ EngineSize        : num  1.8 3.2 2.8 2.8 3.5 2.2 3.8 5.7 3.8 4.9 ...
    ##  $ Horsepower        : int  140 200 172 172 208 110 170 180 170 200 ...
    ##  $ RPM               : int  6300 5500 5500 5500 5700 5200 4800 4000 4800 4100 ...
    ##  $ Rev.per.mile      : int  2890 2335 2280 2535 2545 2565 1570 1320 1690 1510 ...
    ##  $ Man.trans.avail   : Factor w/ 2 levels "No","Yes": 2 2 2 2 2 1 1 1 1 1 ...
    ##  $ Fuel.tank.capacity: num  13.2 18 16.9 21.1 21.1 16.4 18 23 18.8 18 ...
    ##  $ Passengers        : int  5 5 5 6 4 6 6 6 5 6 ...
    ##  $ Length            : int  177 195 180 193 186 189 200 216 198 206 ...
    ##  $ Wheelbase         : int  102 115 102 106 109 105 111 116 108 114 ...
    ##  $ Width             : int  68 71 67 70 69 69 74 78 73 73 ...
    ##  $ Turn.circle       : int  37 38 37 37 39 41 42 45 41 43 ...
    ##  $ Rear.seat.room    : num  26.5 30 28 31 27 28 30.5 30.5 26.5 35 ...
    ##  $ Luggage.room      : int  11 15 14 17 13 16 17 21 14 18 ...
    ##  $ Weight            : int  2705 3560 3375 3405 3640 2880 3470 4105 3495 3620 ...
    ##  $ Origin            : Factor w/ 2 levels "USA","non-USA": 2 2 2 2 2 1 1 1 1 1 ...
    ##  $ Make              : Factor w/ 93 levels "Acura Integra",..: 1 2 4 3 5 6 7 9 8 10 ...

``` r
Cars93_lm <- lm(Price~EngineSize, Cars93)
Cars93_lm
```

    ## 
    ## Call:
    ## lm(formula = Price ~ EngineSize, data = Cars93)
    ## 
    ## Coefficients:
    ## (Intercept)   EngineSize  
    ##       4.669        5.563

``` r
summary(Cars93_lm)
```

    ## 
    ## Call:
    ## lm(formula = Price ~ EngineSize, data = Cars93)
    ## 
    ## Residuals:
    ##     Min      1Q  Median      3Q     Max 
    ## -13.684  -4.627  -1.795   2.592  39.429 
    ## 
    ## Coefficients:
    ##             Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept)   4.6692     2.2390   2.085   0.0398 *  
    ## EngineSize    5.5629     0.7828   7.107 2.59e-10 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 7.789 on 91 degrees of freedom
    ## Multiple R-squared:  0.3569, Adjusted R-squared:  0.3499 
    ## F-statistic: 50.51 on 1 and 91 DF,  p-value: 2.588e-10

1.  회귀모형의 포뮬러 : lm(y~x)
2.  회귀계수 : Coefficients
3.  모형의 설명력 : Adjusted R-squared
4.  모형의 통계적 유의성 : F-statistics

#### 4. R을 이용한 선형회귀모형 진단

``` r
plot(Cars93_lm, which = c(1:6))
```

![](6장.-회귀분석_files/figure-markdown_github/unnamed-chunk-2-1.png)![](6장.-회귀분석_files/figure-markdown_github/unnamed-chunk-2-2.png)![](6장.-회귀분석_files/figure-markdown_github/unnamed-chunk-2-3.png)![](6장.-회귀분석_files/figure-markdown_github/unnamed-chunk-2-4.png)![](6장.-회귀분석_files/figure-markdown_github/unnamed-chunk-2-5.png)![](6장.-회귀분석_files/figure-markdown_github/unnamed-chunk-2-6.png)

1.  Residuals vs Fitted : 오차의 정규성 가정 =\> 오차의 분포는 기울기가
    0인 직선
2.  Normal Q-Q : 오차의 정규성 가정 =\> 그래프의 점들은 45도 각도의 직선
    형태
3.  Scale-Location : (1번과 동일)
4.  Cook’s distance : 한 관측치가 회귀모형에 미치는 영향을 나타내는
    측도, 1 이상일 경우 매우 큰 영향을 주는 관측값
5.  Residuals vs Leverage : 설명변수가 얼마나 극단에 치우쳐 있는지,
    0.5이상인 점은 예측치를 크게 벗어난 관측값
6.  Cook’s dist vs Leverage : 레버리지와 쿡의 거리는 비례하는 관계

#### 5. 선형회귀모형을 활용한 예측

-   predict.lm

``` r
Cars93_lm
```

    ## 
    ## Call:
    ## lm(formula = Price ~ EngineSize, data = Cars93)
    ## 
    ## Coefficients:
    ## (Intercept)   EngineSize  
    ##       4.669        5.563

``` r
set.seed(1234)
idx <- sample(1:nrow(Cars93),5)
idx
```

    ## [1] 28 80 22  9  5

``` r
test <- Cars93[idx,]

# 점추정
predict.lm(Cars93_lm, test, interval = 'none')
```

    ##       28       80       22        9        5 
    ## 21.35801 11.34472 23.02689 25.80836 24.13948

``` r
# 회귀계수의 불확실성을 감안한 구간추정
predict.lm(Cars93_lm, test, interval = 'confidence')
```

    ##         fit       lwr      upr
    ## 28 21.35801 19.672604 23.04341
    ## 80 11.34472  8.555107 14.13433
    ## 22 23.02689 21.145364 24.90842
    ## 9  25.80836 23.426530 28.19019
    ## 5  24.13948 22.078345 26.20061

``` r
# 회귀계수의 불확실성과 오차항을 감안한 구간추정
predict.lm(Cars93_lm, test, interval = 'prediction')
```

    ##         fit       lwr      upr
    ## 28 21.35801  5.795423 36.92060
    ## 80 11.34472 -4.375825 27.06526
    ## 22 23.02689  7.441846 38.61194
    ## 9  25.80836 10.155035 41.46169
    ## 5  24.13948  8.531732 39.74723

### 3절. 다중선형회귀분석

#### 1. 다중선형회귀분석(다변량 회귀분석)

*Y* = *β*<sub>0</sub> + *β*<sub>1</sub>*x*<sub>1</sub> + *β*<sub>2</sub>*x*<sub>2</sub> + ⋯ + *β*<sub>*k*</sub>*x*<sub>*k*</sub> + *ϵ*

#### 2. 다중선형회귀분석 시 검토사항

1.  데이터가 전제하는 가정을 만족시키는가?
2.  모형 내의 회귀계수가 유의한가?
3.  모형은 데이터를 얼마나 설명할 수 있는가?
4.  회귀모형은 통계적으로 유의한가?
5.  모형이 데이터를 잘 적합하고 있는가?
6.  다중공선성

#### 3. 더미변수(dummy variable)

-   범주형 변수 변환 - 기준이 되는 범주를 제외한 n-1개의 변수 생성

-   lm함수의 범주형 변수 처리 - 자동 변환

``` r
data("iris")
iris_lm <- lm(Petal.Length~., iris)
summary(iris_lm)
```

    ## 
    ## Call:
    ## lm(formula = Petal.Length ~ ., data = iris)
    ## 
    ## Residuals:
    ##      Min       1Q   Median       3Q      Max 
    ## -0.78396 -0.15708  0.00193  0.14730  0.65418 
    ## 
    ## Coefficients:
    ##                   Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept)       -1.11099    0.26987  -4.117 6.45e-05 ***
    ## Sepal.Length       0.60801    0.05024  12.101  < 2e-16 ***
    ## Sepal.Width       -0.18052    0.08036  -2.246   0.0262 *  
    ## Petal.Width        0.60222    0.12144   4.959 1.97e-06 ***
    ## Speciesversicolor  1.46337    0.17345   8.437 3.14e-14 ***
    ## Speciesvirginica   1.97422    0.24480   8.065 2.60e-13 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 0.2627 on 144 degrees of freedom
    ## Multiple R-squared:  0.9786, Adjusted R-squared:  0.9778 
    ## F-statistic:  1317 on 5 and 144 DF,  p-value: < 2.2e-16

#### 4. R을 이용한 다중선형회귀분석

-   lm()

``` r
data("Cars93")
str(Cars93)
```

    ## 'data.frame':    93 obs. of  27 variables:
    ##  $ Manufacturer      : Factor w/ 32 levels "Acura","Audi",..: 1 1 2 2 3 4 4 4 4 5 ...
    ##  $ Model             : Factor w/ 93 levels "100","190E","240",..: 49 56 9 1 6 24 54 74 73 35 ...
    ##  $ Type              : Factor w/ 6 levels "Compact","Large",..: 4 3 1 3 3 3 2 2 3 2 ...
    ##  $ Min.Price         : num  12.9 29.2 25.9 30.8 23.7 14.2 19.9 22.6 26.3 33 ...
    ##  $ Price             : num  15.9 33.9 29.1 37.7 30 15.7 20.8 23.7 26.3 34.7 ...
    ##  $ Max.Price         : num  18.8 38.7 32.3 44.6 36.2 17.3 21.7 24.9 26.3 36.3 ...
    ##  $ MPG.city          : int  25 18 20 19 22 22 19 16 19 16 ...
    ##  $ MPG.highway       : int  31 25 26 26 30 31 28 25 27 25 ...
    ##  $ AirBags           : Factor w/ 3 levels "Driver & Passenger",..: 3 1 2 1 2 2 2 2 2 2 ...
    ##  $ DriveTrain        : Factor w/ 3 levels "4WD","Front",..: 2 2 2 2 3 2 2 3 2 2 ...
    ##  $ Cylinders         : Factor w/ 6 levels "3","4","5","6",..: 2 4 4 4 2 2 4 4 4 5 ...
    ##  $ EngineSize        : num  1.8 3.2 2.8 2.8 3.5 2.2 3.8 5.7 3.8 4.9 ...
    ##  $ Horsepower        : int  140 200 172 172 208 110 170 180 170 200 ...
    ##  $ RPM               : int  6300 5500 5500 5500 5700 5200 4800 4000 4800 4100 ...
    ##  $ Rev.per.mile      : int  2890 2335 2280 2535 2545 2565 1570 1320 1690 1510 ...
    ##  $ Man.trans.avail   : Factor w/ 2 levels "No","Yes": 2 2 2 2 2 1 1 1 1 1 ...
    ##  $ Fuel.tank.capacity: num  13.2 18 16.9 21.1 21.1 16.4 18 23 18.8 18 ...
    ##  $ Passengers        : int  5 5 5 6 4 6 6 6 5 6 ...
    ##  $ Length            : int  177 195 180 193 186 189 200 216 198 206 ...
    ##  $ Wheelbase         : int  102 115 102 106 109 105 111 116 108 114 ...
    ##  $ Width             : int  68 71 67 70 69 69 74 78 73 73 ...
    ##  $ Turn.circle       : int  37 38 37 37 39 41 42 45 41 43 ...
    ##  $ Rear.seat.room    : num  26.5 30 28 31 27 28 30.5 30.5 26.5 35 ...
    ##  $ Luggage.room      : int  11 15 14 17 13 16 17 21 14 18 ...
    ##  $ Weight            : int  2705 3560 3375 3405 3640 2880 3470 4105 3495 3620 ...
    ##  $ Origin            : Factor w/ 2 levels "USA","non-USA": 2 2 2 2 2 1 1 1 1 1 ...
    ##  $ Make              : Factor w/ 93 levels "Acura Integra",..: 1 2 4 3 5 6 7 9 8 10 ...

``` r
Price_lm <- lm(Price ~ EngineSize+RPM+Weight, Cars93)
summary(Price_lm)
```

    ## 
    ## Call:
    ## lm(formula = Price ~ EngineSize + RPM + Weight, data = Cars93)
    ## 
    ## Residuals:
    ##     Min      1Q  Median      3Q     Max 
    ## -10.511  -3.806  -0.300   1.447  35.255 
    ## 
    ## Coefficients:
    ##               Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept) -51.793292   9.106309  -5.688 1.62e-07 ***
    ## EngineSize    4.305387   1.324961   3.249  0.00163 ** 
    ## RPM           0.007096   0.001363   5.208 1.22e-06 ***
    ## Weight        0.007271   0.002157   3.372  0.00111 ** 
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 6.504 on 89 degrees of freedom
    ## Multiple R-squared:  0.5614, Adjusted R-squared:  0.5467 
    ## F-statistic: 37.98 on 3 and 89 DF,  p-value: 6.746e-16

1.  회귀모형의 포뮬러 : y ~ x1 + x2 + …
2.  회귀계수 : Coefficients
3.  모형의 설명력 : Adjusted R-squared
4.  모형의 통계적 유의성 : F-statistics

#### 5. 최적회귀방정식의 선택

-   단계적 변수 선택

    1.  전진 선택법
    2.  후진 제거법
    3.  단계적 방법

-   벌점화된 선택기준 - AIC or BIC 값이 최소가 되는 모형

    1.  AIC
    2.  BIC

#### 6. R을 이용한 변수선택법

-   p-value 이용

``` r
data("Cars93")

# 회귀모형
lm_a <- lm(Price~EngineSize+RPM+Width+Length, Cars93)
summary(lm_a)
```

    ## 
    ## Call:
    ## lm(formula = Price ~ EngineSize + RPM + Width + Length, data = Cars93)
    ## 
    ## Residuals:
    ##     Min      1Q  Median      3Q     Max 
    ## -11.756  -4.239  -0.497   2.534  35.598 
    ## 
    ## Coefficients:
    ##               Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept) -20.151609  26.264641  -0.767    0.445    
    ## EngineSize    8.380637   1.445736   5.797 1.04e-07 ***
    ## RPM           0.007139   0.001445   4.942 3.65e-06 ***
    ## Width        -0.654923   0.433125  -1.512    0.134    
    ## Length        0.136676   0.088223   1.549    0.125    
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 6.823 on 88 degrees of freedom
    ## Multiple R-squared:  0.5227, Adjusted R-squared:  0.501 
    ## F-statistic:  24.1 on 4 and 88 DF,  p-value: 1.762e-13

``` r
# 유의확률이 가장 높은 변수 Width 제거 후 회귀모형
lm_b <- lm(Price~EngineSize+RPM+Length, Cars93)
summary(lm_b)
```

    ## 
    ## Call:
    ## lm(formula = Price ~ EngineSize + RPM + Length, data = Cars93)
    ## 
    ## Residuals:
    ##     Min      1Q  Median      3Q     Max 
    ## -11.478  -4.269  -0.378   2.004  36.681 
    ## 
    ## Coefficients:
    ##               Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept) -52.601153  15.251540  -3.449 0.000862 ***
    ## EngineSize    7.110311   1.185062   6.000 4.18e-08 ***
    ## RPM           0.007492   0.001436   5.218 1.17e-06 ***
    ## Length        0.074112   0.078480   0.944 0.347549    
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 6.872 on 89 degrees of freedom
    ## Multiple R-squared:  0.5103, Adjusted R-squared:  0.4938 
    ## F-statistic: 30.92 on 3 and 89 DF,  p-value: 8.699e-14

``` r
# 유의확률이 가장 높은 변수 Length 제거 후 회귀모형
lm_c <- lm(Price~EngineSize+RPM, Cars93)
summary(lm_c)
```

    ## 
    ## Call:
    ## lm(formula = Price ~ EngineSize + RPM, data = Cars93)
    ## 
    ## Residuals:
    ##     Min      1Q  Median      3Q     Max 
    ## -11.636  -4.085  -0.946   1.645  36.543 
    ## 
    ## Coefficients:
    ##               Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept) -40.977171   9.000017  -4.553 1.65e-05 ***
    ## EngineSize    7.913115   0.825140   9.590 2.03e-15 ***
    ## RPM           0.007457   0.001434   5.198 1.25e-06 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 6.868 on 90 degrees of freedom
    ## Multiple R-squared:  0.5054, Adjusted R-squared:  0.4944 
    ## F-statistic: 45.99 on 2 and 90 DF,  p-value: 1.74e-14

-   step(object, scope, direction, k)

``` r
# 후진제거법
lm_result <- lm(Price~EngineSize+Horsepower+RPM+Width+Length, Cars93)
step(lm_result, direction = 'backward')
```

    ## Start:  AIC=327.45
    ## Price ~ EngineSize + Horsepower + RPM + Width + Length
    ## 
    ##              Df Sum of Sq    RSS    AIC
    ## - EngineSize  1      0.05 2764.2 325.45
    ## <none>                    2764.2 327.45
    ## - RPM         1     65.53 2829.7 327.62
    ## - Length      1    285.29 3049.4 334.58
    ## - Width       1    414.88 3179.0 338.45
    ## - Horsepower  1   1332.75 4096.9 362.04
    ## 
    ## Step:  AIC=325.45
    ## Price ~ Horsepower + RPM + Width + Length
    ## 
    ##              Df Sum of Sq    RSS    AIC
    ## <none>                    2764.2 325.45
    ## - RPM         1    120.58 2884.8 327.42
    ## - Length      1    314.61 3078.8 333.47
    ## - Width       1    425.45 3189.7 336.76
    ## - Horsepower  1   2897.11 5661.3 390.12

    ## 
    ## Call:
    ## lm(formula = Price ~ Horsepower + RPM + Width + Length, data = Cars93)
    ## 
    ## Coefficients:
    ## (Intercept)   Horsepower          RPM        Width       Length  
    ##   62.001064     0.174981    -0.002843    -1.347265     0.222816

### 추가

#### 1. 정규화 회귀분석(릿지/라쏘 / 엘라스틱넷)

-   glmnet(x, y, alpha) \# glmnet 패키지

    -   alpha : 0=릿지회귀 / 1=라쏘회귀 / 0.5=엘라스틱넷

-   릿지회귀

``` r
#install.packages('glmnet')
library(glmnet)
```

    ## Loading required package: Matrix

    ## Loaded glmnet 4.1-8

``` r
library(MASS)
data("Cars93")
head(Cars93)
```

    ##   Manufacturer   Model    Type Min.Price Price Max.Price MPG.city MPG.highway
    ## 1        Acura Integra   Small      12.9  15.9      18.8       25          31
    ## 2        Acura  Legend Midsize      29.2  33.9      38.7       18          25
    ## 3         Audi      90 Compact      25.9  29.1      32.3       20          26
    ## 4         Audi     100 Midsize      30.8  37.7      44.6       19          26
    ## 5          BMW    535i Midsize      23.7  30.0      36.2       22          30
    ## 6        Buick Century Midsize      14.2  15.7      17.3       22          31
    ##              AirBags DriveTrain Cylinders EngineSize Horsepower  RPM
    ## 1               None      Front         4        1.8        140 6300
    ## 2 Driver & Passenger      Front         6        3.2        200 5500
    ## 3        Driver only      Front         6        2.8        172 5500
    ## 4 Driver & Passenger      Front         6        2.8        172 5500
    ## 5        Driver only       Rear         4        3.5        208 5700
    ## 6        Driver only      Front         4        2.2        110 5200
    ##   Rev.per.mile Man.trans.avail Fuel.tank.capacity Passengers Length Wheelbase
    ## 1         2890             Yes               13.2          5    177       102
    ## 2         2335             Yes               18.0          5    195       115
    ## 3         2280             Yes               16.9          5    180       102
    ## 4         2535             Yes               21.1          6    193       106
    ## 5         2545             Yes               21.1          4    186       109
    ## 6         2565              No               16.4          6    189       105
    ##   Width Turn.circle Rear.seat.room Luggage.room Weight  Origin          Make
    ## 1    68          37           26.5           11   2705 non-USA Acura Integra
    ## 2    71          38           30.0           15   3560 non-USA  Acura Legend
    ## 3    67          37           28.0           14   3375 non-USA       Audi 90
    ## 4    70          37           31.0           17   3405 non-USA      Audi 100
    ## 5    69          39           27.0           13   3640 non-USA      BMW 535i
    ## 6    69          41           28.0           16   2880     USA Buick Century

``` r
set.seed(1)
train_idx <- sample(1:nrow(Cars93), replace = F, size = nrow(Cars93)*0.7)

# 표준화
train.x <- scale(Cars93[train_idx,c('EngineSize','RPM','Weight')])
test.x <- scale(Cars93[-train_idx,c('EngineSize','RPM','Weight')])

train.y <- scale(Cars93[train_idx,'Price'])
test.y <- scale(Cars93[-train_idx,'Price'])

# 릿지 회귀분석
ridge.lm <- glmnet(train.x,train.y, alpha=0)
plot(ridge.lm, xvar="lambda")
```

![](6장.-회귀분석_files/figure-markdown_github/unnamed-chunk-8-1.png)

-   cv.glmnet(x,y,alpha)\\  
    교차검증방법으로 적절한 lambda 설정

``` r
set.seed(1)
cv.ridge <- cv.glmnet(train.x,train.y,alpha=0)
plot(cv.ridge)
```

![](6장.-회귀분석_files/figure-markdown_github/unnamed-chunk-9-1.png)

``` r
# 오차가 제일 작은 값 = 최적의 lambda
(best_lambda <- cv.ridge$lambda.min)
```

    ## [1] 0.06048311

-   예측

``` r
# case 1.
ridge.lm_opt <- glmnet(train.x,train.y, alpha=0, lambda = best_lambda)
pred_y1 <- predict(ridge.lm_opt, newx = test.x)
pred_y1
```

    ##             s0
    ## 3   0.28248093
    ## 4   0.30470520
    ## 5   0.77316764
    ## 8   0.77837631
    ## 9   0.25665716
    ## 10  0.26107605
    ## 12 -0.69526966
    ## 15 -0.17299940
    ## 16  0.41963511
    ## 19  0.78429993
    ## 26  0.30852007
    ## 27 -0.39578059
    ## 29 -0.59108969
    ## 30  0.71634731
    ## 31 -1.52054098
    ## 41 -0.06512168
    ## 46 -0.84285230
    ## 48  1.46814805
    ## 49  0.27266435
    ## 50  0.71077644
    ## 53 -1.08533686
    ## 57  0.07182343
    ## 77  0.25665716
    ## 79 -0.87978349
    ## 81 -0.80142414
    ## 83 -0.88863386
    ## 86 -0.18663086
    ## 93  0.46012834

``` r
# case 2.
pred_y2 <- predict(cv.ridge, newx = test.x, s='lambda.min')

# test Y 역 표준화 후 plot
plot(test.y * attr(test.y, 'scaled:scale') + attr(test.y, 'scaled:center'), ylab = "y")
# 예측값 역 표준화 후 plot
lines(pred_y1 * attr(test.y, 'scaled:scale') + attr(test.y, 'scaled:center'), col="red") 
```

![](6장.-회귀분석_files/figure-markdown_github/unnamed-chunk-11-1.png)

#### 2. 다항식 회귀분석

``` r
data("quakes")

# 다중회귀분석
lm(mag~lat+long, data=quakes)
```

    ## 
    ## Call:
    ## lm(formula = mag ~ lat + long, data = quakes)
    ## 
    ## Coefficients:
    ## (Intercept)          lat         long  
    ##     7.03350     -0.01049     -0.01465

-   
    *y* = *β*<sub>0</sub> + *β*<sub>1</sub>(*x*<sub>1</sub>+*x*<sub>2</sub>) + *ϵ*

``` r
lm(mag~I(lat+long), data=quakes)
```

    ## 
    ## Call:
    ## lm(formula = mag ~ I(lat + long), data = quakes)
    ## 
    ## Coefficients:
    ##   (Intercept)  I(lat + long)  
    ##       6.71265       -0.01317

-   
    *y* = *β*<sub>0</sub> + *β*<sub>1</sub>*x*<sub>1</sub><sup>2</sup> + *β*<sub>2</sub>*x*<sub>2</sub> + *ϵ*

``` r
lm(mag~I(lat^2)+long, data = quakes)
```

    ## 
    ## Call:
    ## lm(formula = mag ~ I(lat^2) + long, data = quakes)
    ## 
    ## Coefficients:
    ## (Intercept)     I(lat^2)         long  
    ##    7.033584     0.000234    -0.014035

-   
    *y* = *β*<sub>0</sub> + *β*<sub>1</sub>*x* + *β*<sub>2</sub>*x*<sup>2</sup> + *β*<sub>3</sub>*x*<sup>3</sup> + ⋯ + *ϵ*

``` r
lm(mag~lat+I(lat^2)+I(lat^3), data = quakes)
```

    ## 
    ## Call:
    ## lm(formula = mag ~ lat + I(lat^2) + I(lat^3), data = quakes)
    ## 
    ## Coefficients:
    ## (Intercept)          lat     I(lat^2)     I(lat^3)  
    ##   5.616e+00    1.208e-01    4.305e-03    4.267e-05

``` r
lm(mag~poly(lat, 3, raw = T), data=quakes)
```

    ## 
    ## Call:
    ## lm(formula = mag ~ poly(lat, 3, raw = T), data = quakes)
    ## 
    ## Coefficients:
    ##            (Intercept)  poly(lat, 3, raw = T)1  poly(lat, 3, raw = T)2  
    ##              5.616e+00               1.208e-01               4.305e-03  
    ## poly(lat, 3, raw = T)3  
    ##              4.267e-05

#### 3. 곡선 데이터 적합

-   boxcox(object) \# MASS 패키지\\  
    정규분포가 아닌 데이터를 정규분포에 가깝게 만들거나 데이터의 분산을
    안정시켜 정상 데이터로 변환

``` r
x <- 1:100
set.seed(5)
norm <- rnorm(100, 0, 5)
y <- (x+norm)^(-.7)
plot(x, y)
```

![](6장.-회귀분석_files/figure-markdown_github/unnamed-chunk-16-1.png)

``` r
lm_norm <- lm(y~x)
summary(lm_norm)
```

    ## 
    ## Call:
    ## lm(formula = y ~ x)
    ## 
    ## Residuals:
    ##      Min       1Q   Median       3Q      Max 
    ## -0.05866 -0.03292 -0.01095  0.01840  0.28188 
    ## 
    ## Coefficients:
    ##               Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept)  0.1951367  0.0110809   17.61   <2e-16 ***
    ## x           -0.0019952  0.0001886  -10.58   <2e-16 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 0.05285 on 96 degrees of freedom
    ##   (2 observations deleted due to missingness)
    ## Multiple R-squared:  0.5383, Adjusted R-squared:  0.5335 
    ## F-statistic: 111.9 on 1 and 96 DF,  p-value: < 2.2e-16

=\> R^2 = 0.5335로 설명력이 낮은 것을 알 수 있다.

``` r
library(MASS)
bc_norm <- boxcox(lm_norm)
```

![](6장.-회귀분석_files/figure-markdown_github/unnamed-chunk-18-1.png)

``` r
lambda <- bc_norm$x[which.max(bc_norm$y)]

plot(x,y^lambda)
```

![](6장.-회귀분석_files/figure-markdown_github/unnamed-chunk-18-2.png)

``` r
summary(lm(y^lambda~x))
```

    ## 
    ## Call:
    ## lm(formula = y^lambda ~ x)
    ## 
    ## Residuals:
    ##      Min       1Q   Median       3Q      Max 
    ## -11.5838  -3.1118  -0.7141   3.6593  12.2106 
    ## 
    ## Coefficients:
    ##             Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept)  0.49608    1.01030   0.491    0.625    
    ## x            1.01245    0.01719  58.883   <2e-16 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 4.818 on 96 degrees of freedom
    ##   (2 observations deleted due to missingness)
    ## Multiple R-squared:  0.9731, Adjusted R-squared:  0.9728 
    ## F-statistic:  3467 on 1 and 96 DF,  p-value: < 2.2e-16

=\> R^2=0.9731로 설명력이 아주 높아졌다.

-   로그변환

``` r
pl <- iris$Petal.Length
pw <- iris$Petal.Width
pl_r <- 10^pl
pw_r <- 10^pw
```

1.  log(y) = x

``` r
plot(pl, pw_r)
```

![](6장.-회귀분석_files/figure-markdown_github/unnamed-chunk-19-1.png)

``` r
plot(pl, log(pw_r))
```

![](6장.-회귀분석_files/figure-markdown_github/unnamed-chunk-20-1.png)

``` r
summary(lm(log(pw_r) ~ pl))
```

    ## 
    ## Call:
    ## lm(formula = log(pw_r) ~ pl)
    ## 
    ## Residuals:
    ##      Min       1Q   Median       3Q      Max 
    ## -1.30132 -0.28455 -0.04371  0.30596  1.47992 
    ## 
    ## Coefficients:
    ##             Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept) -0.83601    0.09156  -9.131  4.7e-16 ***
    ## pl           0.95731    0.02206  43.387  < 2e-16 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 0.4754 on 148 degrees of freedom
    ## Multiple R-squared:  0.9271, Adjusted R-squared:  0.9266 
    ## F-statistic:  1882 on 1 and 148 DF,  p-value: < 2.2e-16

1.  y = log(x)

``` r
plot(pl_r, pw)
```

![](6장.-회귀분석_files/figure-markdown_github/unnamed-chunk-21-1.png)

``` r
plot(log(pl_r),pw)
```

![](6장.-회귀분석_files/figure-markdown_github/unnamed-chunk-22-1.png)

``` r
summary(lm(pw ~ I(log(pl_r))))
```

    ## 
    ## Call:
    ## lm(formula = pw ~ I(log(pl_r)))
    ## 
    ## Residuals:
    ##      Min       1Q   Median       3Q      Max 
    ## -0.56515 -0.12358 -0.01898  0.13288  0.64272 
    ## 
    ## Coefficients:
    ##               Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept)  -0.363076   0.039762  -9.131  4.7e-16 ***
    ## I(log(pl_r))  0.180560   0.004162  43.387  < 2e-16 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 0.2065 on 148 degrees of freedom
    ## Multiple R-squared:  0.9271, Adjusted R-squared:  0.9266 
    ## F-statistic:  1882 on 1 and 148 DF,  p-value: < 2.2e-16

1.  log(y) = log(x)

``` r
plot(pl_r, pw_r)
```

![](6장.-회귀분석_files/figure-markdown_github/unnamed-chunk-23-1.png)

``` r
plot(log(pl_r), log(pw_r))
```

![](6장.-회귀분석_files/figure-markdown_github/unnamed-chunk-24-1.png)

``` r
summary(lm(log(pw_r) ~ I(log(pl_r))))
```

    ## 
    ## Call:
    ## lm(formula = log(pw_r) ~ I(log(pl_r)))
    ## 
    ## Residuals:
    ##      Min       1Q   Median       3Q      Max 
    ## -1.30132 -0.28455 -0.04371  0.30596  1.47992 
    ## 
    ## Coefficients:
    ##               Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept)  -0.836012   0.091555  -9.131  4.7e-16 ***
    ## I(log(pl_r))  0.415755   0.009582  43.387  < 2e-16 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 0.4754 on 148 degrees of freedom
    ## Multiple R-squared:  0.9271, Adjusted R-squared:  0.9266 
    ## F-statistic:  1882 on 1 and 148 DF,  p-value: < 2.2e-16

#### 4. 일반화 가법모형(General Additive Model)

일반화 가법모형

$$
\hat{y_i}=\hat{\beta_0}+\sum^p\_{j=1}f_i(x\_{ij}+\hat{\epsilon_i})
$$

예측자들을 분리한 후 평활함수f_i 사용. 계산된 값들을 모두 더함으로써
모형 추정

-   gam(formula) \# mgcv 패키지

    -   formula : y~s(x) ※ s():분리해서 사용할 예측자

``` r
#install.packages('mgcv')
library(mgcv)
```

    ## Loading required package: nlme

    ## This is mgcv 1.9-1. For overview type 'help("mgcv-package")'.

``` r
library(MASS) # mcycle data
data("mcycle")
m = gam(accel ~ s(times), data=mcycle)
summary(m)
```

    ## 
    ## Family: gaussian 
    ## Link function: identity 
    ## 
    ## Formula:
    ## accel ~ s(times)
    ## 
    ## Parametric coefficients:
    ##             Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept)  -25.546      1.951   -13.1   <2e-16 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Approximate significance of smooth terms:
    ##            edf Ref.df     F p-value    
    ## s(times) 8.693  8.972 53.52  <2e-16 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## R-sq.(adj) =  0.783   Deviance explained = 79.8%
    ## GCV = 545.78  Scale est. = 506       n = 133

=\> 비선형 모델이므로 coef에 절편만 출력

=\> 설명력(R^2)은 0.783

-   시각화

``` r
plot(m,residuals = T,pch=1,seWithMean = T,shade=T)
```

![](6장.-회귀분석_files/figure-markdown_github/unnamed-chunk-26-1.png)
